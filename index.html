<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Familien- & Wochenplaner</title>
  <style>
    :root{
      --bg:#f5f6fa; --card:#ffffff; --primary:#3949ab; --muted:#e8eaf6; --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);font-family:system-ui,Arial,sans-serif;color:#222;display:flex;flex-direction:column}
    header{background:var(--primary);color:#fff;padding:10px 16px;text-align:center;font-weight:600;letter-spacing:.2px}
    .wrap{padding:12px;display:grid;gap:12px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:0 4px 16px rgba(0,0,0,.08);padding:10px}
    .card h3{margin:0 0 8px 6px;font-size:15px;color:#333}

    /* Grids */
    .top-grid{display:grid;gap:12px;grid-template-columns: 1.2fr 1fr 1.4fr;align-items:stretch}
    .mid-grid,.bottom-grid{display:grid;gap:12px;grid-template-columns: 1fr}

    /* Tabellen */
    table{border-collapse:collapse;width:100%}
    th,td{padding:6px;border:1px solid #e5e5e5;text-align:center;font-size:13px}
    thead tr{background:#e8eaf6}
    .fach-mathe{background:#bbdefb}
    .fach-deutsch{background:#c8e6c9}
    .fach-englisch{background:#ffe0b2}
    .fach-sport{background:#ffccbc}
    .fach-kunst{background:#f8bbd0}

    /* Iframe wrappers */
    .iframe-wrap{border:1px solid #eee;border-radius:10px;overflow:hidden}
    iframe{display:block;width:100%;border:0}

    /* Tasks */
    .task-item{display:flex;align-items:center;gap:6px;padding:4px}
    .task-item .title{font-weight:600;font-size:13px}
    .task-col{display:grid;gap:8px}

    @media (max-width:1100px){.top-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
<header>ðŸ“… Familien- & Wochenplaner</header>
<div class="wrap">

  <!-- ===== OBERER BEREICH ===== -->
  <div class="top-grid">
    <!-- Spalte 1: HEUTE â€“ Valentin: Stundenplan & Termine (nur heutige) -->
    <section class="card">
      <h3>Heute Â· Valentin â€“ Stundenplan & Termine</h3>
      <div style="display:grid;gap:6px;grid-template-rows:auto 200px">
        <!-- Stundenplan HEUTE -->
        <div class="iframe-wrap" style="padding:6px">
          <table>
            <thead>
              <tr><th>Zeit</th><th>Fach</th><th>Raum</th></tr>
            </thead>
            <tbody id="stundenplan-heute"></tbody>
          </table>
        </div>
        <!-- Termine HEUTE (Valentin-Kalender als Agenda-Tag) -->
        <div class="iframe-wrap"><iframe id="valentin-today" height="200" loading="lazy"></iframe></div>
      </div>
    </section>

    <!-- Spalte 2: Aufgaben â€“ Heute (lokal, mit Datum) -->
    <section class="card task-col">
      <h3>Aufgaben Â· Heute</h3>
      <form id="task-form" style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:4px">
        <input id="task-title" placeholder="Neue Aufgabe" required style="flex:2;min-width:180px;padding:8px;border:1px solid #ddd;border-radius:8px;font-size:13px"/>
        <input id="task-date" type="date" style="flex:1;min-width:140px;padding:8px;border:1px solid #ddd;border-radius:8px;font-size:13px"/>
        <button style="padding:8px 12px;border:0;background:#3949ab;color:#fff;border-radius:10px;font-weight:600">+</button>
      </form>
      <div id="tasks-today"></div>
    </section>

    <!-- Spalte 3: MORGEN â€“ Valentin: Stundenplan, Termine & Tasks -->
    <section class="card">
      <h3>Morgen Â· Valentin â€“ Stundenplan, Termine & Tasks</h3>
      <div style="display:grid;gap:6px;grid-template-rows:auto 220px auto">
        <!-- Stundenplan MORGEN -->
        <div class="iframe-wrap" style="padding:6px">
          <table>
            <thead>
              <tr><th>Zeit</th><th>Fach</th><th>Raum</th></tr>
            </thead>
            <tbody id="stundenplan-morgen"></tbody>
          </table>
        </div>
        <!-- Termine MORGEN (Valentin-Kalender als Agenda-Tag) -->
        <div class="iframe-wrap"><iframe id="valentin-tomorrow" height="220" loading="lazy"></iframe></div>
        <!-- Tasks MORGEN (lokal gefiltert auf Datum morgen) -->
        <div class="iframe-wrap" style="padding:6px">
          <div style="font-weight:600;margin:2px 0 6px 0">Aufgaben Â· Morgen</div>
          <div id="tasks-tomorrow"></div>
        </div>
      </div>
    </section>
  </div>

  <!-- ===== MITTLERER BEREICH: FIXER STUNDENPLAN ===== -->
  <section class="card">
    <h3>Fixer Stundenplan (Schuljahr)</h3>
    <div style="overflow:auto">
      <table>
        <thead>
          <tr><th>Zeit</th><th>Mo</th><th>Di</th><th>Mi</th><th>Do</th><th>Fr</th></tr>
        </thead>
        <tbody id="stundenplan-fix"><!-- Hier bitte die echten Stundenplandaten eintragen --></tbody>
      </table>
    </div>
  </section>

  <!-- ===== UNTERER BEREICH: Zusammengefasste Ãœbersicht ===== -->
  <section class="card">
    <h3>Woche Â· Dienstplan + Sonstige Termine (kombiniert)</h3>
    <div class="iframe-wrap"><iframe id="combined-week" height="300" loading="lazy"></iframe></div>
  </section>

</div>

<script>
  // Kalender-IDs (robuster als komplette URLs)
  const CAL = {
    VALENTIN: '057e175cb88528446a3b90c6e6ff1124f870e0d6b97ded0da00e1fce8e509188@group.calendar.google.com',
    GENERAL:  'gabstaschill@gmail.com',
    DIENST:   'emujcvc9sc89j8gi2l9kdvf1i0@group.calendar.google.com',
    BDAY:     'addressbook#contacts@group.v.calendar.google.com'
  };

  // Hilfsfunktionen
  function toYMD(d){
    const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), da=String(d.getDate()).padStart(2,'0');
    return `${y}${m}${da}`;
  }
  function toISO(d){
    const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), da=String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${da}`;
  }
  function buildBase(params){
    const base = 'https://calendar.google.com/calendar/embed?';
    const common = [
      'ctz=Europe/Berlin', 'showTitle=0','showPrint=0','showCalendars=0','showTz=0','wkst=2'
    ];
    return base + [...common, ...params].join('&');
  }
  function urlAgendaDay(calIds, ymd){
    const srcs = calIds.map(id => `src=${encodeURIComponent(id)}`);
    return buildBase(['mode=AGENDA', `dates=${ymd}/${ymd}`, ...srcs]);
  }
  function urlWeek(calIds){
    const srcs = calIds.map(id => `src=${encodeURIComponent(id)}`);
    return buildBase(['mode=WEEK', ...srcs]);
  }

  const now = new Date();
  const TODAY_YMD = toYMD(now);
  const TOMORROW_DATE = new Date(now); TOMORROW_DATE.setDate(now.getDate()+1);
  const TOMORROW_YMD = toYMD(TOMORROW_DATE);
  const TODAY_ISO = toISO(now);
  const TOMORROW_ISO = toISO(TOMORROW_DATE);

  // === Iframes mit exakten Tages-Ansichten ===
  document.getElementById('valentin-today').src    = urlAgendaDay([CAL.VALENTIN], TODAY_YMD);
  document.getElementById('valentin-tomorrow').src = urlAgendaDay([CAL.VALENTIN], TOMORROW_YMD);

  // Kombinierte WochenÃ¼bersicht: Allgemein + Dienst + Geburtstage + Valentin
  document.getElementById('combined-week').src = urlWeek([CAL.GENERAL, CAL.DIENST, CAL.BDAY, CAL.VALENTIN]);

  // ===== Aufgaben (lokal) =====
  const STORAGE_KEY = 'family_tasks_v1';
  const tasksTodayEl = document.getElementById('tasks-today');
  const tasksTomorrowEl = document.getElementById('tasks-tomorrow');
  const form = document.getElementById('task-form');
  const titleInput = document.getElementById('task-title');
  const dateInput = document.getElementById('task-date');

  function loadTasks(){ try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [] } catch(e){ return [] } }
  function saveTasks(list){ localStorage.setItem(STORAGE_KEY, JSON.stringify(list)) }

  function renderTasks(containerEl, predicate){
    const list = loadTasks().filter(predicate);
    containerEl.innerHTML = list.length ? '' : '<div style="color:#666;font-size:12px">Keine Aufgaben.</div>';
    list.forEach((t)=>{
      const row = document.createElement('div'); row.className = 'task-item';
      row.innerHTML = `
        <input type="checkbox" ${t.done?'checked':''} data-id="${t.id||''}" style="transform:scale(1.1)">
        <div style="flex:1">
          <div class="title">${t.title}</div>
          ${t.date ? `<div style=\"font-size:11px;color:#666\">FÃ¤llig: ${t.date}</div>` : ''}
        </div>`;
      row.querySelector('input').addEventListener('change',(e)=>{
        const all = loadTasks(); const idx = all.findIndex(x=>(x.id||'')===(t.id||''));
        if(idx>-1){all[idx].done=e.target.checked;saveTasks(all);}  
      });
      containerEl.appendChild(row);
    });
  }

  function refreshTasks(){
    renderTasks(tasksTodayEl,  t => (t.date||TODAY_ISO) === TODAY_ISO);
    renderTasks(tasksTomorrowEl, t => t.date === TOMORROW_ISO);
  }

  form.addEventListener('submit',(e)=>{
    e.preventDefault();
    const title = titleInput.value.trim(); if(!title) return;
    const date  = (dateInput.value||'').trim();
    const all = loadTasks();
    all.unshift({ id:String(Date.now()), title, date: date || null, done:false });
    saveTasks(all);
    titleInput.value=''; dateInput.value='';
    refreshTasks();
  });

  refreshTasks();

  // ===== Stundenplan HEUTE & MORGEN (Beispielwerte) =====
  const stHeute = document.getElementById('stundenplan-heute');
  const stMorgen = document.getElementById('stundenplan-morgen');
  const testLessonsToday = [
    {time:'08:00â€“08:45',subject:'Mathe',room:'101',cls:'fach-mathe'},
    {time:'09:00â€“09:45',subject:'Englisch',room:'204',cls:'fach-englisch'},
    {time:'10:00â€“10:45',subject:'Deutsch',room:'112',cls:'fach-deutsch'}
  ];
  const testLessonsTomorrow = [
    {time:'08:00â€“08:45',subject:'Deutsch',room:'101',cls:'fach-deutsch'},
    {time:'09:00â€“09:45',subject:'Mathe',room:'204',cls:'fach-mathe'},
    {time:'10:00â€“10:45',subject:'Sport',room:'Halle',cls:'fach-sport'}
  ];
  stHeute.innerHTML  = testLessonsToday.map(l=>`<tr><td>${l.time}</td><td class="${l.cls}">${l.subject}</td><td>${l.room}</td></tr>`).join('');
  stMorgen.innerHTML = testLessonsTomorrow.map(l=>`<tr><td>${l.time}</td><td class="${l.cls}">${l.subject}</td><td>${l.room}</td></tr>`).join('');
</script>
</body>
</html>
