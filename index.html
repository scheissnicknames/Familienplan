<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Familien- & Wochenplaner</title>
  <style>
    :root{
      --bg:#f5f6fa; --card:#ffffff; --primary:#3949ab; --muted:#e8eaf6; --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);font-family:system-ui,Arial,sans-serif;color:#222;display:flex;flex-direction:column}
    header{background:var(--primary);color:#fff;padding:10px 16px;text-align:center;font-weight:600;letter-spacing:.2px}
    .wrap{padding:12px;display:grid;gap:12px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:0 4px 16px rgba(0,0,0,.08);padding:10px}
    .card h3{margin:0 0 8px 6px;font-size:15px;color:#333}

    /* Grids */
    .top-grid{display:grid;gap:12px;grid-template-columns: 1.3fr 1fr 1.5fr;align-items:stretch}
    .mid-grid,.bottom-grid{display:grid;gap:12px;grid-template-columns: 1fr}

    /* Stundenplan Tabelle */
    table{border-collapse:collapse;width:100%}
    th,td{padding:6px;border:1px solid #e5e5e5;text-align:center;font-size:13px}
    thead tr{background:#e8eaf6}
    .fach-mathe{background:#bbdefb}
    .fach-deutsch{background:#c8e6c9}
    .fach-englisch{background:#ffe0b2}
    .fach-sport{background:#ffccbc}
    .fach-kunst{background:#f8bbd0}

    /* Iframe wrappers */
    .iframe-wrap{border:1px solid #eee;border-radius:10px;overflow:hidden}
    iframe{display:block;width:100%;border:0}

    /* Tasks */
    .task-item{display:flex;align-items:center;gap:6px;padding:4px}
    .task-item .title{font-weight:600;font-size:13px}

    @media (max-width:1100px){
      .top-grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
<header>ðŸ“… Familien- & Wochenplaner</header>
<div class="wrap">

  <!-- ===== OBERER BEREICH ===== -->
  <div class="top-grid">
    <!-- Spalte 1: Stundenplan + Termine (Valentin) HEUTE -->
    <section class="card">
      <h3>Heute Â· Valentin: Stundenplan & Termine</h3>
      <div style="display:grid;gap:6px;grid-template-rows:auto 200px">
        <div class="iframe-wrap" style="padding:6px">
          <table>
            <thead>
              <tr><th>Zeit</th><th>Fach</th><th>Raum</th></tr>
            </thead>
            <tbody id="stundenplan-heute"></tbody>
          </table>
        </div>
        <div class="iframe-wrap"><iframe id="valentin-today" height="200" loading="lazy"></iframe></div>
      </div>
    </section>

    <!-- Spalte 2: Aufgaben HEUTE (lokal) -->
    <section class="card">
      <h3>Aufgaben Â· Heute</h3>
      <form id="task-form" style="display:flex;gap:6px;margin-bottom:6px">
        <input id="task-title" placeholder="Neue Aufgabe" required style="flex:1;padding:8px;border:1px solid #ddd;border-radius:8px;font-size:13px"/>
        <button style="padding:8px 12px;border:0;background:#3949ab;color:#fff;border-radius:10px;font-weight:600">+</button>
      </form>
      <div id="tasks-today"></div>
    </section>

    <!-- Spalte 3: Extratermine & Tasks aus Google (Allgemeiner Kalender) MORGEN -->
    <section class="card">
      <h3>Morgen Â· Allgemeiner Kalender & Tasks</h3>
      <div class="iframe-wrap"><iframe id="general-tomorrow" height="260" loading="lazy"></iframe></div>
    </section>
  </div>

  <!-- ===== MITTLERER BEREICH: FIXER STUNDENPLAN ===== -->
  <section class="card">
    <h3>Fixer Stundenplan (Schuljahr)</h3>
    <div style="overflow:auto">
      <table>
        <thead>
          <tr><th>Zeit</th><th>Mo</th><th>Di</th><th>Mi</th><th>Do</th><th>Fr</th></tr>
        </thead>
        <tbody id="stundenplan-fix">
          <!-- Hier bitte die echten Stundenplandaten eintragen -->
        </tbody>
      </table>
    </div>
  </section>

  <!-- ===== UNTERER BEREICH ===== -->
  <section class="card">
    <h3>Dein Dienstplan (Woche)</h3>
    <div class="iframe-wrap"><iframe id="dienst-woche" height="180" loading="lazy"></iframe></div>
  </section>

  <section class="card">
    <h3>Sonstige Termine (Allgemeiner Kalender)</h3>
    <div class="iframe-wrap"><iframe id="general-week" height="280" loading="lazy"></iframe></div>
  </section>

</div>

<script>
  const SRC_VALENTIN = "https://calendar.google.com/calendar/embed?src=057e175cb88528446a3b90c6e6ff1124f870e0d6b97ded0da00e1fce8e509188%40group.calendar.google.com&ctz=Europe%2FBerlin";
  const SRC_GENERAL  = "https://calendar.google.com/calendar/embed?src=gabstaschill%40gmail.com&ctz=Europe%2FBerlin";
  const SRC_DIENST   = "https://calendar.google.com/calendar/embed?src=emujcvc9sc89j8gi2l9kdvf1i0%40group.calendar.google.com&ctz=Europe%2FBerlin";

  function buildAgendaDay(src, date){
    const params = [
      'mode=AGENDA','showTitle=0','showPrint=0','showCalendars=0','showTz=0','wkst=2',`dates=${date}/${date}`
    ].join('&');
    return `${src}&${params}`;
  }
  function buildWeek(src){
    const params = ['mode=WEEK','showTitle=0','showPrint=0','showCalendars=0','showTz=0','wkst=2'].join('&');
    return `${src}&${params}`;
  }

  function toYMD(d){
    const y = d.getFullYear(); const m = String(d.getMonth()+1).padStart(2,'0'); const da = String(d.getDate()).padStart(2,'0');
    return `${y}${m}${da}`;
  }
  const now = new Date();
  const TODAY = toYMD(now);
  const tomorrow = new Date(now); tomorrow.setDate(now.getDate()+1);
  const TOMORROW = toYMD(tomorrow);

  document.getElementById('valentin-today').src = buildAgendaDay(SRC_VALENTIN, TODAY);
  document.getElementById('general-tomorrow').src = buildAgendaDay(SRC_GENERAL, TOMORROW);
  document.getElementById('dienst-woche').src = buildWeek(SRC_DIENST);
  document.getElementById('general-week').src = buildWeek(SRC_GENERAL);

  // Aufgaben HEUTE (lokal)
  const STORAGE_KEY = 'family_tasks_v1';
  const tasksTodayEl = document.getElementById('tasks-today');
  const form = document.getElementById('task-form');
  const titleInput = document.getElementById('task-title');

  function loadTasks(){ try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [] } catch(e){ return [] } }
  function saveTasks(list){ localStorage.setItem(STORAGE_KEY, JSON.stringify(list)) }

  function renderTasksToday(){
    const list = loadTasks();
    const y = now.getFullYear(); const m = String(now.getMonth()+1).padStart(2,'0'); const d = String(now.getDate()).padStart(2,'0');
    const iso = `${y}-${m}-${d}`;
    const todays = list.filter(t => !t.date || t.date === iso);
    tasksTodayEl.innerHTML = todays.length ? '' : '<div style="color:#666;font-size:12px">Keine Aufgaben fÃ¼r heute.</div>';
    todays.forEach((t)=>{
      const row = document.createElement('div'); row.className = 'task-item';
      row.innerHTML = `
        <input type="checkbox" ${t.done?'checked':''} data-id="${t.id||''}" style="transform:scale(1.1)">
        <div style="flex:1">
          <div class="title">${t.title}</div>
          ${t.date ? `<div style=\\"font-size:11px;color:#666\\">FÃ¤llig: ${t.date}</div>` : ''}
        </div>`;
      row.querySelector('input').addEventListener('change',(e)=>{
        const all = loadTasks(); const idx = all.findIndex(x=>(x.id||'')===(t.id||''));
        if(idx>-1){all[idx].done=e.target.checked;saveTasks(all);}
      });
      tasksTodayEl.appendChild(row);
    });
  }

  form.addEventListener('submit',(e)=>{
    e.preventDefault();
    const title=titleInput.value.trim(); if(!title) return;
    const all=loadTasks(); all.unshift({id:String(Date.now()),title,date:null,done:false});
    saveTasks(all); titleInput.value=''; renderTasksToday();
  });

  renderTasksToday();

  // Stundenplan HEUTE (Beispiel)
  const stHeute=document.getElementById('stundenplan-heute');
  const testLessons=[
    {time:'08:00â€“08:45',subject:'Mathe',room:'101',cls:'fach-mathe'},
    {time:'09:00â€“09:45',subject:'Englisch',room:'204',cls:'fach-englisch'},
    {time:'10:00â€“10:45',subject:'Deutsch',room:'112',cls:'fach-deutsch'}
  ];
  stHeute.innerHTML=testLessons.map(l=>`<tr><td>${l.time}</td><td class="${l.cls}">${l.subject}</td><td>${l.room}</td></tr>`).join('');
</script>
</body>
</html>
